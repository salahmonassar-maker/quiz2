<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ â€“ Ø­Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
<style>
body{
    font-family: Tahoma;
    direction: rtl;
    background:#1b2735;
    color:#fff;
    margin:0;
    padding:0;
}
.container{
    max-width:800px;
    margin:auto;
    background:#2c3e50;
    border-radius:15px;
    padding:20px;
    margin-top:20px;
}
h1,h2,h3{color:#ffdd57;}
input,button{
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
    font-size:16px;
}
button{background:#f39c12;cursor:pointer;}
button:hover{background:#f1c40f;}
.question{
    background:#34495e;
    padding:10px;
    border-radius:8px;
    margin:10px 0;
}
label{display:block; margin:5px 0;}
</style>
</head>
<body>

<div class="container">
<h1>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ â€“ Ø­Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h1>

<h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
<input id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"><br>
<input id="subjectInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
<input id="topicInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"><br>
<button onclick="loadExam()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>

<hr>

<div id="examContainer"></div>

<button id="submitBtn" style="display:none" onclick="submitExam()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>

<div id="resultMsg"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyAC4PNyd-nolBmhhbn_AIWS5e1FaN4DoMI",
  authDomain: "online-exam-3d750.firebaseapp.com",
  projectId: "online-exam-3d750",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let examQuestions = [];

// ==== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ====
async function loadExam(){
    const studentName = document.getElementById("studentName").value.trim();
    const subject = document.getElementById("subjectInput").value.trim();
    const topic = document.getElementById("topicInput").value.trim();
    if(!studentName || !subject || !topic){ alert("âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª"); return; }

    const docRef = db.collection("exams").doc(subject+"_"+topic);
    const docSnap = await docRef.get();

    if(!docSnap.exists){
        alert("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹");
        return;
    }

    examQuestions = docSnap.data().questions;
    renderExam();
}

function renderExam(){
    const container = document.getElementById("examContainer");
    container.innerHTML = "";
    examQuestions.forEach((q,i)=>{
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `<strong>Ø³Ø¤Ø§Ù„ ${i+1}:</strong> ${q.q}<br>
            <label><input type="radio" name="q${i}" value="0"> ${q.o[0]}</label>
            <label><input type="radio" name="q${i}" value="1"> ${q.o[1]}</label>
            <label><input type="radio" name="q${i}" value="2"> ${q.o[2]}</label>
            <label><input type="radio" name="q${i}" value="3"> ${q.o[3]}</label>`;
        container.appendChild(div);
    });
    document.getElementById("submitBtn").style.display = "block";
}

// ==== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ====
async function submitExam(){
    const studentName = document.getElementById("studentName").value.trim();
    const subject = document.getElementById("subjectInput").value.trim();
    const topic = document.getElementById("topicInput").value.trim();
    if(!studentName || !subject || !topic){ alert("âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª"); return; }

    let score = 0;
    examQuestions.forEach((q,i)=>{
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if(selected && parseInt(selected.value) === q.a){
            score++;
        }
    });

    try{
        await db.collection("results").add({
            student: studentName,
            subject: subject,
            topic: topic,
            score: score,
            total: examQuestions.length,
            submittedAt: new Date()
        });
        document.getElementById("resultMsg").innerText = `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. Ø¯Ø±Ø¬ØªÙƒ: ${score} / ${examQuestions.length}`;
        document.getElementById("submitBtn").style.display = "none";
    } catch(err){
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: " + err.message);
    }
}
</script>

</body>
</html>
