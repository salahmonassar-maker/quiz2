<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
<style>
body{
    font-family: Tahoma;
    direction: rtl;
    background:#1b2735;
    color:#fff;
    margin:0;
    padding:0;
}
.container{
    max-width:1000px;
    margin:auto;
    background:#2c3e50;
    border-radius:15px;
    padding:20px;
    margin-top:20px;
}
h1,h2,h3{color:#ffdd57;}
input,button{
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
    font-size:16px;
}
button{background:#f39c12;cursor:pointer;}
button:hover{background:#f1c40f;}
.question{
    background:#34495e;
    padding:10px;
    border-radius:8px;
    margin:10px 0;
}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    border:1px solid #fff;
    padding:8px;
    text-align:center;
}
</style>
</head>
<body>

<div class="container">
<h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª â€“ Ø§Ù„Ù…Ø¹Ù„Ù…</h1>

<h3>Ø¥Ù†Ø´Ø§Ø¡ / Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¶ÙˆØ¹</h3>
<input id="subjectInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
<input id="topicInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹">
<br>
<label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨:
<input type="number" id="numQuestions" value="5"></label>
<label>Ø²Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¯Ù‚Ø§Ø¦Ù‚):
<input type="number" id="timeLimit" value="10"></label>
<br><br>
<button onclick="loadTopic()">ØªØ­Ù…ÙŠÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</button>

<hr>

<h3>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¤Ø§Ù„</h3>
<input id="qText" style="width:95%" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„"><br>
<input id="o0" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 1">
<input id="o1" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 2">
<input id="o2" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 3">
<input id="o3" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 4"><br>
<input id="correct" type="number" min="0" max="3" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0-3)">
<br>
<button onclick="addQuestion()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
<button onclick="updateQuestion()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</button>

<hr>

<h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
<table id="questionsTable">
<tr><th>#</th><th>Ø§Ù„Ø³Ø¤Ø§Ù„</th><th>Ø­Ø°Ù</th></tr>
</table>

<br>
<!-- ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
<button onclick="exportQuestions()">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
<input type="file" id="importFile" style="display:inline-block" onchange="importQuestions(event)">
<br><br>
<button onclick="publishExam()">ğŸ’¾ Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyAC4PNyd-nolBmhhbn_AIWS5e1FaN4DoMI",
  authDomain: "online-exam-3d750.firebaseapp.com",
  projectId: "online-exam-3d750",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª =====
let questions = [];
let editIndex = null;
let currentSubject = "";
let currentTopic = "";

// ==== ØªØ­Ù…ÙŠÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¶ÙˆØ¹ ====
function loadTopic(){
    let subject = subjectInput.value.trim();
    let topic = topicInput.value.trim();
    if(!subject){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©"); return; }
    if(!topic){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"); return; }
    
    currentSubject = subject;
    currentTopic = topic;

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ù† localStorage
    let key = "quiz_"+subject+"_"+topic;
    questions = JSON.parse(localStorage.getItem(key)) || [];
    render();
    alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: "+subject+" â€“ "+topic);
}

// ==== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ====
function render(){
    questionsTable.innerHTML="<tr><th>#</th><th>Ø§Ù„Ø³Ø¤Ø§Ù„</th><th>Ø­Ø°Ù</th></tr>";
    questions.forEach((q,i)=>{
        let r = questionsTable.insertRow();
        r.insertCell(0).innerText = i+1;
        r.insertCell(1).innerText = q.q;
        r.insertCell(2).innerHTML = `<button onclick="loadQuestion(${i})">âœï¸</button>
                                     <button onclick="del(${i})">âŒ</button>`;
    });
    // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ localStorage
    if(currentSubject && currentTopic){
        localStorage.setItem("quiz_"+currentSubject+"_"+currentTopic, JSON.stringify(questions));
    }
}

function addQuestion(){
    if(!qText.value || !o0.value || !o1.value || !o2.value || !o3.value || correct.value===""){
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
        return;
    }
    questions.push({
        q: qText.value,
        o: [o0.value,o1.value,o2.value,o3.value],
        a: +correct.value
    });
    clearForm();
    render();
}

function loadQuestion(i){
    editIndex = i;
    qText.value = questions[i].q;
    [o0.value,o1.value,o2.value,o3.value] = questions[i].o;
    correct.value = questions[i].a;
}

function updateQuestion(){
    if(editIndex===null){ alert("Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„Ù‹Ø§ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹"); return; }
    questions[editIndex] = {
        q: qText.value,
        o: [o0.value,o1.value,o2.value,o3.value],
        a: +correct.value
    };
    editIndex = null;
    clearForm();
    render();
}

function del(i){
    if(confirm("Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ")){
        questions.splice(i,1);
        render();
    }
}

function clearForm(){
    qText.value=o0.value=o1.value=o2.value=o3.value=correct.value="";
}

// ==== ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ ====
function exportQuestions(){
    if(questions.length===0){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§!"); return; }
    let a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([JSON.stringify(questions)], {type:"application/json"}));
    a.download = currentSubject+"_"+currentTopic+"_questions.json";
    a.click();
}

function importQuestions(e){
    let file = e.target.files[0];
    if(!file) return;
    let reader = new FileReader();
    reader.onload = () => {
        try{
            questions = JSON.parse(reader.result);
            render();
            alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!");
        }catch(err){
            alert("Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­");
        }
    };
    reader.readAsText(file);
}

// ==== Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ====
function publishExam(){
    if(!currentSubject){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©"); return; }
    if(!currentTopic){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"); return; }
    if(questions.length===0){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }

    let numQ = +numQuestions.value;
    let time = +timeLimit.value;

    db.collection("exams").doc(currentSubject+"_"+currentTopic).set({
        subject: currentSubject,
        topic: currentTopic,
        questions,
        numQuestions: numQ,
        timeLimit: time,
        createdAt: new Date()
    }).then(()=>{
        alert("âœ”ï¸ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­");
    }).catch(err=>{
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±: "+err);
    });
}
</script>

</body>
</html>
