<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
<style>
body{
    font-family: Tahoma;
    direction: rtl;
    background:#1b2735;
    color:#fff;
}
.container{
    max-width:1000px;
    margin:auto;
    background:#2c3e50;
    border-radius:15px;
    padding:20px;
    margin-top:20px;
}
h1,h2,h3{color:#ffdd57;}
input,button{
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
    font-size:16px;
}
button{background:#f39c12;cursor:pointer;}
button:hover{background:#f1c40f;}
.question{
    background:#34495e;
    padding:10px;
    border-radius:8px;
    margin:10px 0;
}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    border:1px solid #fff;
    padding:8px;
    text-align:center;
}
</style>
</head>
<body>

<div class="container">
<h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª â€“ Ø§Ù„Ù…Ø¹Ù„Ù…</h1>

<input id="subjectInput" placeholder="ÙÙŠØ²ÙŠØ§Ø¡">
<input id="topicInput" placeholder="Ø§Ù„Ø·ÙŠÙ">
<br>

<label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:
<input type="number" id="numQuestions" value="5"></label>

<label>Ø²Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¯Ù‚Ø§Ø¦Ù‚):
<input type="number" id="timeLimit" value="10"></label>

<hr>

<h3>Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</h3>
<input id="qText" style="width:95%" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„"><br>
<input id="o0" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 1">
<input id="o1" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 2">
<input id="o2" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 3">
<input id="o3" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± 4"><br>
<input id="correct" type="number" min="0" max="3" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0-3)">
<br>
<button onclick="addQuestion()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>

<hr>

<h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
<table id="questionsTable">
<tr><th>#</th><th>Ø§Ù„Ø³Ø¤Ø§Ù„</th><th>Ø­Ø°Ù</th></tr>
</table>

<br>
<!-- Ø£Ø²Ø±Ø§Ø± ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ -->
<button onclick="exportQuestions()">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
<input type="file" id="importFile" style="display:inline-block" onchange="importQuestions(event)">

<br><br>
<button onclick="publishExam()">ğŸ’¾ Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨</button>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyAC4PNyd-nolBmhhbn_AIWS5e1FaN4DoMI",
  authDomain: "online-exam-3d750.firebaseapp.com",
  projectId: "online-exam-3d750",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let questions = [];

function addQuestion(){
    questions.push({
        q: qText.value,
        o: [o0.value,o1.value,o2.value,o3.value],
        a: +correct.value
    });
    clearForm();
    render();
}

function render(){
    questionsTable.innerHTML="<tr><th>#</th><th>Ø§Ù„Ø³Ø¤Ø§Ù„</th><th>Ø­Ø°Ù</th></tr>";
    questions.forEach((q,i)=>{
        let r=questionsTable.insertRow();
        r.insertCell(0).innerText=i+1;
        r.insertCell(1).innerText=q.q;
        r.insertCell(2).innerHTML=`<button onclick="del(${i})">âŒ</button>`;
    });
}

function del(i){
    questions.splice(i,1);
    render();
}

function clearForm(){
    qText.value=o0.value=o1.value=o2.value=o3.value=correct.value="";
}

// ==== ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ====
function exportQuestions(){
    if(questions.length===0){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§!"); return; }
    let a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([JSON.stringify(questions)], {type:"application/json"}));
    a.download = "questions.json";
    a.click();
}

// ==== Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ====
function importQuestions(e){
    let file = e.target.files[0];
    if(!file) return;
    let reader = new FileReader();
    reader.onload = () => {
        try{
            questions = JSON.parse(reader.result);
            render();
            alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!");
        }catch(err){
            alert("Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­");
        }
    };
    reader.readAsText(file);
}

// ==== Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù„Ù‰ Firebase ====
function publishExam(){
    let subject=subjectInput.value.trim();
    let topic=topicInput.value.trim();
    if(!subject||!topic||questions.length===0){
        alert("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
        return;
    }

    db.collection("exams").doc(subject+"_"+topic).set({
        subject,
        topic,
        questions,
        numQuestions:+numQuestions.value,
        timeLimit:+timeLimit.value,
        createdAt:new Date()
    }).then(()=>{
        alert("âœ”ï¸ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­");
    }).catch(err=>{
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±: "+err);
    });
}
</script>

</body>
</html>
