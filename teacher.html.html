<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
<style>
body{
    font-family: Tahoma;
    direction: rtl;
    background:#1b2735;
    color:#fff;
    margin:0;
    padding:0;
}
.container{
    max-width:1000px;
    margin:auto;
    background:#2c3e50;
    border-radius:15px;
    padding:20px;
    margin-top:20px;
    overflow:hidden;
}
h1,h2,h3{color:#ffdd57;}
input,button,select{
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
    font-size:16px;
}
button{
    background:#f39c12;
    cursor:pointer;
}
button:hover{background:#f1c40f;}
.question{
    background:#34495e;
    padding:15px;
    border-radius:10px;
    margin:15px 0;
}
label{
    display:block;
    background:#3c5a72;
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    cursor:pointer;
}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}
th,td{
    border:1px solid #fff;
    padding:10px;
    text-align:center;
}
.section{display:none; max-height:650px; overflow-y:auto;}
.section.active{display:block;}
</style>
</head>
<body>

<div class="container">
<h1 id="dynamicTitle">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h1>

<h3>Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
<input id="subjectInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
<input id="topicInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹">
<br>
<button onclick="loadTopic()">ØªØ­Ù…ÙŠÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</button>

<hr>

<div id="config" class="section">
<h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
<label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨:
<input type="number" id="numQuestions" min="1" value="3"></label>
<label>Ø²Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚):
<input type="number" id="timeLimit" min="1" value="10"></label>
</div>

<hr>

<div id="adminPanel" class="section">
<h2>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
<input id="qText" style="width:90%" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„"><br>
<input id="o0" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„">
<input id="o1" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ">
<input id="o2" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«">
<input id="o3" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹"><br>
<input id="correct" type="number" min="0" max="3" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0-3)">
<br><br>
<button onclick="addQuestion()">â• Ø¥Ø¶Ø§ÙØ©</button>
<button onclick="updateQuestion()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
<button onclick="exportQuestions()">â¬‡ï¸ ØªØµØ¯ÙŠØ±</button>
<input type="file" onchange="importQuestions(event)">
<table id="questionsTable"></table>
</div>

<hr>

<div id="final" class="section">
<h2>Ø§Ù„ÙƒØ´Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
<table id="resultsTable">
<tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr>
</table>
</div>

</div>

<script>
// ==== Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ====
let storageKey="";
let allQuestions=[];
let usedQuestions=[];
let results=[];
let editIndex=null;

// ==== ØªØ­Ù…ÙŠÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¶ÙˆØ¹ ====
function loadTopic(){
    let subject = subjectInput.value.trim();
    let topic = topicInput.value.trim();
    if(subject==="" || topic===""){alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ù…ÙˆØ¶ÙˆØ¹"); return;}
    storageKey = "quiz_"+subject+"_"+topic;
    dynamicTitle.innerText = subject+" â€“ "+topic;

    allQuestions = JSON.parse(localStorage.getItem(storageKey))||[];
    usedQuestions=[];
    results=[];
    resultsTable.innerHTML="<tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr>";

    document.getElementById("config").classList.add("active");
    document.getElementById("adminPanel").classList.add("active");
    document.getElementById("final").classList.add("active");
    renderQuestions();
    localStorage.setItem("currentSubject", subject);
    localStorage.setItem("currentTopic", topic);
}

// ==== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ====
function renderQuestions(){
    questionsTable.innerHTML="<tr><th>#</th><th>Ø§Ù„Ø³Ø¤Ø§Ù„</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>";
    allQuestions.forEach((q,i)=>{
        let r = questionsTable.insertRow();
        r.insertCell(0).innerText = i+1;
        r.insertCell(1).innerText = q.q;
        r.insertCell(2).innerHTML=`<button onclick="loadQuestion(${i})">âœï¸</button>
                                   <button onclick="deleteQuestion(${i})">âŒ</button>`;
    });
    localStorage.setItem(storageKey, JSON.stringify(allQuestions));
}

function addQuestion(){
    allQuestions.push({q:qText.value, o:[o0.value,o1.value,o2.value,o3.value], a:+correct.value});
    clearForm(); renderQuestions();
}

function loadQuestion(i){
    editIndex=i;
    qText.value = allQuestions[i].q;
    [o0.value,o1.value,o2.value,o3.value] = allQuestions[i].o;
    correct.value = allQuestions[i].a;
}

function updateQuestion(){
    allQuestions[editIndex]={q:qText.value,o:[o0.value,o1.value,o2.value,o3.value],a:+correct.value};
    editIndex=null;
    clearForm(); renderQuestions();
}

function deleteQuestion(i){
    if(confirm("Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ")){
        allQuestions.splice(i,1);
        renderQuestions();
    }
}

function clearForm(){
    qText.value=o0.value=o1.value=o2.value=o3.value=correct.value="";
}

// ==== Ø§Ø³ØªÙŠØ±Ø§Ø¯ / ØªØµØ¯ÙŠØ± ====
function exportQuestions(){
    let a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([JSON.stringify(allQuestions)],{type:"application/json"}));
    a.download=storageKey+".json";
    a.click();
}

function importQuestions(e){
    let r = new FileReader();
    r.onload=()=>{allQuestions = JSON.parse(r.result); renderQuestions();}
    r.readAsText(e.target.files[0]);
}

// ==== ÙƒØ´Ù Ø§Ù„Ø·Ù„Ø§Ø¨ ====
function updateFinalTable(){
    resultsTable.innerHTML="<tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr>";
    results.forEach(r=>{
        let row=resultsTable.insertRow();
        row.insertCell(0).innerText=r.name;
        row.insertCell(1).innerText=r.score;
    });
}

// ==== Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ø§Ù„Ø¨ ====
function saveForStudent(){
    let data = {
        questions: allQuestions,
        numQuestions: +document.getElementById("numQuestions").value,
        timeLimit: +document.getElementById("timeLimit").value
    };
    localStorage.setItem("quiz_default", JSON.stringify(data.questions));
    localStorage.setItem("numQuestions", data.numQuestions);
    localStorage.setItem("timeLimit", data.timeLimit);
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ø§Ù„Ø¨ØŒ ÙŠÙ…ÙƒÙ†Ù‡ ÙØªØ­ Ù†Ø³Ø®Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¢Ù†");
}

// ==== ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ø§Ù„Ø¨ ====
function generateStudentLink(){
    if(allQuestions.length===0){
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø©");
        return;
    }
    let data = btoa(unescape(encodeURIComponent(JSON.stringify(allQuestions))));
    let link = "student.html?" +
        "sub=" + encodeURIComponent(subjectInput.value) +
        "&topic=" + encodeURIComponent(topicInput.value) +
        "&n=" + numQuestions.value +
        "&t=" + timeLimit.value +
        "&q=" + data;
    prompt("Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨:", link);
}

// Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø­ÙØ¸ Ù„Ù„Ø·Ø§Ù„Ø¨
let btnSave = document.createElement("button");
btnSave.innerText="ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ø§Ù„Ø¨";
btnSave.onclick = saveForStudent;
document.getElementById("adminPanel").appendChild(btnSave);

// Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø¹Ø¯ Ø²Ø± Ø§Ù„Ø­ÙØ¸
let btnLink = document.createElement("button");
btnLink.innerText="ğŸ”— ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ø§Ù„Ø¨";
btnLink.onclick = generateStudentLink;
document.getElementById("adminPanel").appendChild(btnLink);

// Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
renderQuestions();
</script>

</body>
</html>